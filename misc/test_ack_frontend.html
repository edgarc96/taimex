<!DOCTYPE html>
<html>
<head>
    <title>Test ACK Frontend</title>
</head>
<body>
    <h3>Test Acknowledgment Frontend Processing</h3>
    <button onclick="testAckData()">Test with Sample ACK Data</button>
    
    <div style="margin: 20px 0;">
        <h4>ACK Fields:</h4>
        <div style="display: grid; grid-template-columns: 1fr 80px; gap: 8px; width: 200px;">
            <div>Ack Date</div><div>Qty</div>
            <input type="date" id="ackDate1" style="border: 1px solid #cbd5e1; border-radius: 4px; padding: 6px; font-size: 11px;">
            <input type="number" id="ackQty1" step="0.01" style="border: 1px solid #cbd5e1; border-radius: 4px; padding: 6px; font-size: 11px;">
            <input type="date" id="ackDate2" style="border: 1px solid #cbd5e1; border-radius: 4px; padding: 6px; font-size: 11px;">
            <input type="number" id="ackQty2" step="0.01" style="border: 1px solid #cbd5e1; border-radius: 4px; padding: 6px; font-size: 11px;">
        </div>
    </div>
    
    <div id="ackDisplay" style="margin-top: 20px; padding: 12px; background: #fef3f2; border: 1px solid #fecaca; border-radius: 6px; display: none;">
        <div style="font-weight: 600; margin-bottom: 8px; color: #dc2626;">âœ… Existing Acknowledgments from Database</div>
        <div id="ackContent"></div>
    </div>

    <script>
    function testAckData() {
        // Create sample acknowledgment data structure
        const sampleAckData = {
            ack_line: [
                {
                    ack_entry: [
                        { date: '12/15/2024', quantity: '50' },
                        { date: '01/10/2025', quantity: '25' }
                    ]
                }
            ]
        };
        
        console.log('Testing with sample acknowledgment data:', sampleAckData);
        
        // Test the populate function
        populateAcknowledgmentFields(sampleAckData);
        displayAcknowledgmentsFromPO(sampleAckData);
    }
    
    function populateAcknowledgmentFields(acknowledgments) {
        console.log('Populating acknowledgment fields with:', acknowledgments);
        
        // Clear all acknowledgment fields first
        for (let i = 1; i <= 2; i++) {
            const dateField = document.getElementById(`ackDate${i}`);
            const qtyField = document.getElementById(`ackQty${i}`);
            if (dateField) dateField.value = '';
            if (qtyField) qtyField.value = '';
        }
        
        let fieldIndex = 1;
        
        // Process acknowledgments structure
        if (acknowledgments.ack_line) {
            const ackLines = Array.isArray(acknowledgments.ack_line) ? acknowledgments.ack_line : [acknowledgments.ack_line];
            
            for (const ackLine of ackLines) {
                if (ackLine.ack_entry && fieldIndex <= 2) {
                    const ackEntries = Array.isArray(ackLine.ack_entry) ? ackLine.ack_entry : [ackLine.ack_entry];
                    
                    for (const entry of ackEntries) {
                        if (fieldIndex <= 2) {
                            const dateField = document.getElementById(`ackDate${fieldIndex}`);
                            const qtyField = document.getElementById(`ackQty${fieldIndex}`);
                            
                            if (dateField && entry.date) {
                                // Convert date format if needed (from MM/DD/YYYY to YYYY-MM-DD for input[type="date"])
                                let dateValue = entry.date;
                                if (dateValue.includes('/')) {
                                    const parts = dateValue.split('/');
                                    if (parts.length === 3) {
                                        const month = parts[0].padStart(2, '0');
                                        const day = parts[1].padStart(2, '0');
                                        const year = parts[2];
                                        dateValue = `${year}-${month}-${day}`;
                                    }
                                }
                                dateField.value = dateValue;
                                console.log(`Set ackDate${fieldIndex} to:`, dateValue);
                            }
                            
                            if (qtyField && entry.quantity) {
                                qtyField.value = entry.quantity;
                                console.log(`Set ackQty${fieldIndex} to:`, entry.quantity);
                            }
                            
                            fieldIndex++;
                        }
                    }
                }
            }
        }
        
        console.log(`Populated ${fieldIndex - 1} acknowledgment entries`);
    }

    function displayAcknowledgmentsFromPO(acknowledgments) {
        console.log('Displaying acknowledgments from PO:', acknowledgments);
        
        const ackDisplay = document.getElementById('ackDisplay');
        const contentDiv = document.getElementById('ackContent');
        
        ackDisplay.style.display = 'block';
        let html = '';
        
        // Process acknowledgments structure - should be array of ack_line objects
        if (acknowledgments.ack_line) {
            const ackLines = Array.isArray(acknowledgments.ack_line) ? acknowledgments.ack_line : [acknowledgments.ack_line];
            
            ackLines.forEach((ackLine, lineIndex) => {
                if (ackLine.ack_entry) {
                    const ackEntries = Array.isArray(ackLine.ack_entry) ? ackLine.ack_entry : [ackLine.ack_entry];
                    
                    ackEntries.forEach((entry, entryIndex) => {
                        html += `
                            <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #dc2626;">
                                <div style="font-size: 10px; font-weight: 500; color: #6b7280; margin-bottom: 2px;">Line ${lineIndex + 1} - ACK ${entryIndex + 1}</div>
                                <div style="font-size: 11px; color: #374151;">
                                    <strong>Date:</strong> ${entry.date || 'N/A'} | <strong>Quantity:</strong> ${entry.quantity || 'N/A'}
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }
        
        if (html === '') {
            html = '<div style="font-size: 11px; color: #6b7280; font-style: italic;">No acknowledgments found in database.</div>';
        }
        
        contentDiv.innerHTML = html;
    }
    </script>
</body>
</html>
