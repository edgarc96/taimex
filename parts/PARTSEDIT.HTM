<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TAIMEX - PARTS EDIT</title>
  <!-- Removed external Font Awesome; using inline SVG icons to avoid external dependencies -->
  <style>*{margin:0;padding:0;box-sizing:border-box}html,body{height:100vh;overflow:hidden;width:100%}body{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);color:#334155;width:100%}.container{width:100%;height:100vh;background:#fff;display:flex;flex-direction:column;overflow:hidden}.header{background:linear-gradient(135deg,#1e293b 0%,#1e3a8a 100%);color:#fff;padding:12px 24px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px rgba(30,41,59,.25);position:relative;z-index:100;width:100%}.header-left{display:flex;align-items:center;gap:20px;position:relative;z-index:1}.logo-section img{height:40px;width:auto;object-fit:contain;filter:brightness(1.05)}.title-section{text-align:right;position:relative;z-index:1}.title-row{display:flex;align-items:center;justify-content:flex-end;gap:15px}.welcome-user{white-space:nowrap}.welcome-user span{color:#cbd5e1;font-size:.8em;font-weight:400}.welcome-user strong{color:#3b82f6;margin-left:4px;font-weight:600}.title-section h2{font-size:.95em;margin:0;font-weight:500;color:#cbd5e1;letter-spacing:.3px}.title-section p{font-size:.75em;margin:2px 0 0 0;color:#a2a8ba;font-weight:400}.hamburger-menu{background:none;border:none;color:#fff;font-size:1.2em;cursor:pointer;padding:8px;border-radius:6px;transition:background-color .2s ease}.hamburger-menu:hover{background-color:rgba(255,255,255,.12)}.main-content{flex:1;display:flex;flex-direction:column;overflow:hidden;width:100%}.sidebar{position:fixed;top:0;left:-300px;width:300px;height:100vh;background:rgba(255,255,255,.08);backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px);color:#fff;transition:left .2s ease;z-index:2000;box-shadow:2px 0 12px rgba(0,0,0,.35)}.sidebar.active{left:0}.sidebar-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.55);opacity:0;visibility:hidden;transition:all .25s ease;z-index:1500;pointer-events:none}.sidebar-overlay.active{opacity:1;visibility:visible;pointer-events:auto}.sidebar-content{padding:24px}.sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.05)}.sidebar-header h3{font-size:1.2em;color:#fff;margin:0}.sidebar-menu{list-style:none;padding:0;margin:0}.sidebar-menu li{margin-bottom:8px}.sidebar-menu a{display:block;padding:12px 16px;color:#f3f4f6;text-decoration:none;border-radius:8px;transition:all .2s ease;font-weight:500}.sidebar-menu a:hover{background-color:rgba(30,64,175,.1);color:#fff}.sidebar-menu a.active{background-color:rgba(30,64,175,.2);color:#93c5fd}.sidebar-menu a i{margin-right:12px;width:20px;text-align:center}.tab-navigation{background:#fff;border-bottom:1px solid #e2e8f0;width:100%}.tab-buttons{display:flex;flex-wrap:wrap;width:100%}.tab-button{background:none;border:none;padding:12px 20px;color:#64748b;font-weight:500;cursor:pointer;transition:all .3s ease;border-bottom:3px solid transparent;display:flex;align-items:center;gap:8px}.tab-button:hover{color:#1e40af;background:rgba(30,64,175,.05)}.tab-button.active{color:#1e40af;background:rgba(30,64,175,.1);border-bottom-color:#1e40af;font-weight:600}.tab-content{flex:1;overflow:hidden;width:100%}.tab-pane{display:none;height:100%;overflow-y:auto;padding:16px 20px;background:#f8fafc;width:100%}.tab-pane.active{display:block}.form-container{background:rgba(255,255,255,.9);border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 8px 32px rgba(0,0,0,.1);width:100%;max-width:none}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:16px;width:100%;max-width:none}.form-group{display:flex;flex-direction:column}.form-group label{font-weight:600;color:#374151;margin-bottom:8px}.form-group input,.form-group select,.form-group textarea{padding:10px 12px;border:2px solid #e5e7eb;border-radius:8px;transition:.2s;width:100%}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#3b82f6}.btn{padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:.2s;display:inline-flex;align-items:center;gap:8px}.btn-primary{background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%);color:white}.btn-secondary{background:#6b7280;color:white}.form-actions{display:flex;gap:12px;margin-top:20px}.search-container{margin-bottom:12px;width:100%}.search-container input{width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:8px}.excel-grid-wrapper{background:rgba(255,255,255,.95);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);overflow:hidden;flex:1;display:flex;flex-direction:column;min-height:0;width:100%}.grid-toolbar{background:#f8f9fa;padding:12px 20px;border-bottom:1px solid #dee2e6;display:flex;align-items:center;justify-content:space-between;width:100%}.results-count{background:rgba(59,130,246,0.1);padding:4px 12px;border-radius:20px;font-size:.85em;color:#64748b}.excel-grid-container{flex:1;overflow-y:auto;overflow-x:auto;border:1px solid #dee2e6;border-radius:0 0 12px 12px;background:#fff;position:relative;min-height:250px;height:calc(100vh - 240px);width:100%}.excel-grid-container::-webkit-scrollbar{width:12px}.excel-grid-container::-webkit-scrollbar-track{background:#f1f3f4;border-radius:6px}.excel-grid-container::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#2a5298 0%,#1e3c72 100%);border-radius:6px;border:2px solid #f1f3f4}.excel-grid-container::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%)}table.excel-grid-premium{width:100%;border-collapse:collapse;font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;font-size:11px;background:#fff;min-width:100%;border:1px solid #dee2e6}.excel-header{background:linear-gradient(135deg,#2a5298 0%,#1e3c72 100%);color:white;padding:8px 12px;font-weight:600;text-align:left;border-right:1px solid #1e3c72;position:sticky;top:0;z-index:10;cursor:pointer;user-select:none;transition:all .2s ease;font-size:11px}.excel-header:hover{background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%)}.excel-header.sorted{background:linear-gradient(135deg,#2a5298 0%,#1e3c72 100%)}.header-content{display:flex;align-items:center;justify-content:space-between;gap:8px}.sort-icon{opacity:.7;font-size:12px;transition:opacity .2s ease}.excel-header:hover .sort-icon{opacity:1}.resize-handle{position:absolute;right:0;top:0;bottom:0;width:4px;cursor:col-resize;background:rgba(255,255,255,.2);opacity:0;transition:opacity .2s ease}.excel-header:hover .resize-handle{opacity:1}.excel-row{transition:all .2s ease;cursor:pointer}.excel-row:nth-child(even){background:#fafafa}.excel-row:hover{background:#eef2ff}.excel-row.selected{background:#dbeafe}.filter-row th{background:#f1f5f9;position:sticky;top:36px;z-index:5}.filter-cell{padding:6px 8px;border-bottom:1px solid #e5e7eb}.filter-input{width:100%;padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;font-size:12px}.toolbar-right{display:flex;gap:8px}.grid-btn{background:#e2e8f0;color:#1e293b;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:12px;display:inline-flex;align-items:center;gap:6px}.grid-btn:hover{filter:brightness(.95)}.excel-cell{padding:8px 10px;border-bottom:1px solid #e5e7eb}.excel-cell.readonly{opacity:.85}.cell-content{display:flex;align-items:center;gap:6px}.action-buttons{display:flex;align-items:center;justify-content:center;gap:8px}.btn-sm{border:none;padding:6px 8px;border-radius:6px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}.btn-edit{background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%);color:#fff}.btn-delete{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff}.actions-header{min-width:120px} .notification-container{position:fixed;top:20px;right:20px;z-index:10000;pointer-events:none} .notification{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 10px 25px rgba(16,185,129,.3);display:flex;align-items:center;gap:12px;font-weight:500;font-size:14px;min-width:300px;transform:translateX(400px);opacity:0;transition:all .4s cubic-bezier(0.175,0.885,0.32,1.275);border-left:4px solid #34d399;backdrop-filter:blur(10px)} .notification.show{transform:translateX(0);opacity:1} .notification.hide{transform:translateX(400px);opacity:0} .notification-icon{background:rgba(255,255,255,.2);border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:16px;animation:pulse 2s infinite} .notification-content{flex:1} .notification-title{font-weight:600;margin-bottom:2px} .notification-message{font-size:13px;opacity:.9} @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}} .notification.bounce{animation:slideInBounce .6s cubic-bezier(0.175,0.885,0.32,1.275)} @keyframes slideInBounce{0%{transform:translateX(400px) scale(.8);opacity:0}60%{transform:translateX(-10px) scale(1.02);opacity:1}100%{transform:translateX(0) scale(1);opacity:1}} .notification.error{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);box-shadow:0 10px 25px rgba(239,68,68,.3);border-left:4px solid #f87171} .notification.warning{background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);box-shadow:0 10px 25px rgba(245,158,11,.3);border-left:4px solid #fbbf24} .notification.info{background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);box-shadow:0 10px 25px rgba(59,130,246,.3);border-left:4px solid #60a5fa} .notification.loading{background:linear-gradient(135deg,#10b981 0%,#059669 100%);box-shadow:0 10px 25px rgba(16,185,129,.3);border-left:4px solid #34d399} .notification.loading .notification-icon i{animation:spin 1s linear infinite} @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}</style>
</head>
<body>
  <style>
    /* Sidebar - Force override with !important */
    .sidebar {
            position: fixed !important;
            top: 0 !important;
            left: -300px !important;
            width: 300px !important;
            height: 100vh !important;
            background: rgba(255, 255, 255, .08) !important;
            backdrop-filter: blur(1px) !important;
            -webkit-backdrop-filter: blur(1px) !important;
            color: white !important;
            transition: left 0.2s ease !important;
            z-index: 2000 !important;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3) !important;
    }
    .sidebar.active { left: 0 !important; }
    .sidebar-overlay {
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            width: 100vw !important; 
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.5) !important; 
            opacity: 0 !important; 
            visibility: hidden !important;
            transition: all 0.3s ease !important; 
            z-index: 999 !important; 
            pointer-events: none !important;
    }
    .sidebar-overlay.active { 
            opacity: 1 !important; 
            visibility: visible !important; 
            pointer-events: auto !important; 
    }

    .sidebar-content { padding: 24px !important; }

    .sidebar-header {
            padding: 20px !important; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            background: rgba(255, 255, 255, 0.05) !important;
    }
    .sidebar-header h3 { 
            font-size: 1.2em !important; 
            color: white !important; 
            margin: 0 !important; 
    }

    .sidebar-menu { 
            list-style: none !important; 
            padding: 0 !important; 
            margin: 0 !important; 
    }
    .sidebar-menu li { margin-bottom: 8px !important; }
    .sidebar-menu a, .sidebar-menu label {
            display: block !important;
            padding: 12px 16px !important;
            color: #f3f4f6 !important;
            text-decoration: none !important;
            border-radius: 8px !important;
            transition: all 0.2s ease !important;
            font-weight: 500 !important;
    }
    .sidebar-menu a:hover, .sidebar-menu label:hover { 
            background-color: rgba(30, 64, 175, 0.1) !important; 
            color: white !important; 
    }
    .sidebar-menu a.active, .sidebar-menu label.active { 
            background-color: rgba(30, 64, 175, 0.2) !important; 
            color: #93c5fd !important; 
    }
    .sidebar-menu a i, .sidebar-menu label i { 
            margin-right: 12px !important; 
            width: 20px !important; 
            text-align: center !important; 
    }
    .sidebar-menu label { cursor: pointer !important; }
    /* Inline SVG icon styling - match Font Awesome sizing */
    .hamburger-menu svg { width: 1em; height: 1em; fill: currentColor; display: inline-block; vertical-align: -0.125em; }

    /* CSS-only toggle using hidden checkbox */
    #sb-toggle { position: absolute; left: -9999px; }
    #sb-toggle:checked ~ .sidebar { left: 0 !important; }
    #sb-toggle:checked ~ .sidebar-overlay { opacity: 1 !important; visibility: visible !important; pointer-events: auto !important; }
  </style>
  <style>
    /* Grid Styles copied from PRICE_EDIT3 for pixel-perfect match */
    .excel-grid-wrapper {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .excel-grid-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      border: 1px solid #dee2e6;
      border-radius: 0 0 12px 12px;
      background: white;
      position: relative;
      min-height: 250px;
      max-height: calc(100vh - 200px);
      height: calc(100vh - 200px);
      margin-top: 8px;
    }
    .excel-grid-container::-webkit-scrollbar { width: 12px; }
    .excel-grid-container::-webkit-scrollbar-track { background: #f1f3f4; border-radius: 6px; }
    .excel-grid-container::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%); border-radius: 6px; border: 2px solid #f1f3f4; }
    .excel-grid-container::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }

    .grid-toolbar {
      background: #f8f9fa;
      padding: 12px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toolbar-left .results-count { color: #6c757d; font-size: 14px; font-weight: 500; }
    .toolbar-right { display: flex; gap: 10px; }
    .grid-btn {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white; border: none; padding: 8px 16px; border-radius: 6px;
      font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; gap: 6px;
    }
    .grid-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(42, 82, 152, 0.4); }
    .filter-input { width: 220px; padding: 6px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; background: white; transition: all 0.2s ease; }
    .filter-input:focus { outline: none; border-color: #2a5298; box-shadow: 0 0 0 2px rgba(42, 82, 152, 0.2); }

    .excel-grid-premium { width: 100%; border-collapse: collapse; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11px; background: white; min-width: 1000px; border: 1px solid #dee2e6; }
    .excel-header { background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%); color: white; padding: 8px 12px; font-weight: 600; text-align: left; border-right: 1px solid #1e3c72; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none; transition: all 0.2s ease; font-size: 11px; }
    .excel-header:last-child { border-right: none; }
    .header-content { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .resize-handle { position: absolute; right: 0; top: 0; bottom: 0; width: 4px; cursor: col-resize; background: rgba(255, 255, 255, 0.2); opacity: 0; transition: opacity 0.2s ease; }
    .excel-header:hover .resize-handle { opacity: 1; }
    .excel-row { transition: all 0.2s ease; cursor: pointer; }
    .excel-row:nth-child(even) { background: #f8f9fa; }
    .excel-row:hover { background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); transform: translateX(2px); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    .excel-cell { padding: 6px 10px; border-right: 1px solid #dee2e6; border-bottom: 1px solid #dee2e6; vertical-align: middle; position: relative; font-size: 11px; }
    .excel-cell:last-child { border-right: none; }

    /* PRICE_EDIT-style toolbar search */
    .toolbar-search { position: relative; display: inline-block; }
    .toolbar-search .filter-input { width: 260px; height: 32px; border-radius: 20px; padding-left: 30px; padding-right: 10px; }
    .toolbar-search .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 14px; height: 14px; color: #6c757d; opacity: 0.9; pointer-events: none; }
  </style>
  <script>
    // Removed preview error overlay to prevent blocking header clicks
  </script>
  <input type="checkbox" id="sb-toggle" />
  <label for="sb-toggle" class="sidebar-overlay"></label>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>Menu</h3>
    </div>
    <div class="sidebar-content">
      <ul class="sidebar-menu">
                <li><label for="sb-toggle" class="active">Customer Search</label></li>
                <li><label for="sb-toggle">Sales Orders</label></li>
                <li><label for="sb-toggle">Reports</label></li>
                <li><label for="sb-toggle">Customer Management</label></li>
                <li><label for="sb-toggle">Settings</label></li>
                <li><label for="sb-toggle">Help</label></li>
      </ul>
    </div>
  </div>
  
  <div class="container">
    <div class="header">
      <div class="header-left">
        <label class="hamburger-menu" for="sb-toggle" aria-label="Open menu">
          <svg viewBox="0 0 448 512" role="img" aria-hidden="true" focusable="false">
            <path d="M0 96C0 78.3 14.3 64 32 64H416C433.7 64 448 78.3 448 96C448 113.7 433.7 128 416 128H32C14.3 128 0 113.7 0 96zM0 256C0 238.3 14.3 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.3 288 0 273.7 0 256zM448 416C448 433.7 433.7 448 416 448H32C14.3 448 0 433.7 0 416C0 398.3 14.3 384 32 384H416C433.7 384 448 398.3 448 416z"></path>
          </svg>
        </label>
        <div class="logo-section">
          <img src="http://54.189.226.145/uploads/assets/images/taimex_logo.png" alt="TAIMEX" onerror="this.onerror=null;this.src='http://54.189.226.145/uploads/assets/images/taimex_logo.png';">
        </div>
      </div>
      <div class="title-section">
        <div class="title-row">
          <div class="welcome-user">
            <span>Welcome</span>
            <strong>Admin User</strong>
          </div>
          <div>
            <h2>TAIMEX - PARTS EDIT</h2>
            <p>TAIMEX - MANAGEMENT</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="main-content">
      <div class="tab-navigation">
        <div class="tab-buttons">
        <button type="button" class="tab-button active" data-tab-index="0">
          + Data Capture
        </button>
        <button type="button" class="tab-button " data-tab-index="1">
          üîç Search & View
        </button>
        <button type="button" class="tab-button " data-tab-index="2">
          üë• Gestionar Usuarios
        </button>
        </div>
      </div>
      <div class="tab-content">
<div class="tab-pane active" id="tab-0"><div class="form-container"><h3 style="margin-bottom:24px; color:#1e293b;">Data Capture</h3><style>.form-group.required>label::after{content:" *";color:#ef4444;margin-left:4px}.info-alert{display:flex;gap:10px;align-items:flex-start;background:#eff6ff;border-left:4px solid #3b82f6;padding:12px 16px;border-radius:8px;color:#1e3a8a;margin-bottom:16px}.info-alert i{color:#3b82f6;margin-top:2px}.tab-pane .form-container{max-width:none;width:100%;margin:0;padding:20px 40px;display:flex;flex-direction:column;align-items:stretch}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;max-width:none;width:100%;grid-auto-flow:row dense}.form-group{width:100%;min-width:0}.form-group.span-2{grid-column:span 2}</style><div class="info-alert"><i class="fas fa-info-circle"></i><div><strong>Important:</strong> Fields marked with <span style="color:#ef4444">*</span> are required. If applicable, both parts of the part number are required for exact searches.</div></div><form class="form-grid" onsubmit="return false;">            <div class="form-group required">
                <label>Part Number</label>
                <input type="text" placeholder="Part Number" name="part_number" required aria-required="true" onkeydown="handlePartKeyDown(event)" oninput="handlePartNumberChange()" id="partNumberInput"></input>
              </div>
            <div class="form-group required">
                <label>Part description</label>
                <input type="text" placeholder="Part description" name="part_description" required aria-required="true" id="partDescriptionInput"></input>
              </div>
            <div class="form-group">
                <label>Product time</label>
                <input type="text" placeholder="Product time" name="product_time"></input>
              </div>
            <div class="form-group">
                <label>Status</label>
                <input type="text" placeholder="Select status" name="status"></input>
              </div>
            <div class="form-group">
                <label>Safety Stock</label>
                <input type="text" placeholder="Safety stock" name="safety_stock"></input>
              </div>
            <div class="form-group">
                <label>Lead time</label>
                <input type="text" placeholder="lead time" name="lead_time"></input>
              </div>
            <div class="form-group">
                <label>UM</label>
                <input type="text" placeholder="Unit Measure" name="um"></input>
              </div>
            <div class="form-group">
                <label>Supplier Number</label>
                <input type="text" placeholder="Supplier number" name="supplier_number"></input>
              </div>
            <div class="form-group">
                <label>Commodity code</label>
                <input type="text" placeholder="Commodity code" name="commodity_code"></input>
              </div>
            <div class="form-group span-2">
                <label>PO description</label>
                <input type="text" placeholder="PO description" name="po_description"></input>
              </div></form><div class="form-actions"><button type="button" class="btn btn-primary" onclick="return handleSave()"><i class="fas fa-save"></i> Save</button><button type="button" class="btn btn-secondary" onclick="return handleClear()"><i class="fas fa-undo"></i> Clear</button></div></div></div><div class="tab-pane " id="tab-1"><div class="form-container"><h3 style="margin-bottom:24px; color:#1e293b;">Search & View</h3><div id="searchViewGridWrapper" class="excel-grid-wrapper"></div></div></div>
  <div class="excel-grid-wrapper" id="authGridWrapper">    <div class="grid-toolbar">      <div class="toolbar-left"><span class="results-count"><i class="fas fa-lock"></i> Authorization Rules</span></div>      <div class="toolbar-right">        <button type="button" class="grid-btn" onclick="return addAuthRule()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;"><i class="fas fa-plus"></i> Add Authorization</button>      </div>    </div>    <div class="excel-grid-container">      <table class="excel-grid-premium">        <thead>          <tr>            <th class="excel-header"><div class="header-content"><i class="fas fa-id-badge"></i> Initials</div><span class="resize-handle"></span></th>            <th class="excel-header"><div class="header-content"><i class="fas fa-user"></i> Name</div><span class="resize-handle"></span></th>            <th class="excel-header"><div class="header-content"><i class="fas fa-receipt"></i> Transaction</div><span class="resize-handle"></span></th>            <th class="excel-header"><div class="header-content"><i class="fas fa-route"></i> Src</div><span class="resize-handle"></span></th>            <th class="excel-header"><div class="header-content"><i class="fas fa-key"></i> Permission</div><span class="resize-handle"></span></th>            <th class="excel-header"><div class="header-content"><i class="fas fa-toggle-on"></i> Active</div><span class="resize-handle"></span></th>            <th class="excel-header actions-header"><div class="header-content"><i class="fas fa-cogs"></i> Actions</div></th>          </tr>          <tr class="filter-row">            <th class="filter-cell"><input type="text" class="filter-input" placeholder="Filter initials..." onkeyup="return filterAuthRules()" id="auth_filter_initials"></th>            <th class="filter-cell"></th>            <th class="filter-cell"><input type="text" class="filter-input" placeholder="Filter txn..." onkeyup="return filterAuthRules()" id="auth_filter_txn"></th>            <th class="filter-cell"><input type="text" class="filter-input" placeholder="Filter src..." onkeyup="return filterAuthRules()" id="auth_filter_src"></th>            <th class="filter-cell"></th>            <th class="filter-cell"></th>            <th class="filter-cell"></th>          </tr>        </thead>        <tbody id="authTableBody"></tbody>      </table>    </div>  </div></div><div class="tab-pane " id="tab-2"><div class="form-container"><h3 style="margin-bottom:24px; color:#1e293b;">Gestionar Usuarios</h3><p>Content for Gestionar Usuarios.</p></div></div>
      </div>
    </div>
  </div>
  
  <div class="notification-container" id="notificationContainer"></div>
  
  <script>
    var __schemaFields = [{"label":"Part Number","name":"part_number","type":"text","placeholder":"Part Number"},{"label":"Part description","name":"part_description","type":"text","placeholder":"Part description"},{"label":"Product time","name":"product_time","type":"text","placeholder":"Product time"},{"label":"Status","name":"status","type":"text","placeholder":"Select status"},{"label":"Safety Stock","name":"safety_stock","type":"text","placeholder":"Safety stock"},{"label":"Lead time","name":"lead_time","type":"text","placeholder":"lead time"},{"label":"UM","name":"um","type":"text","placeholder":"Mnit Measure"},{"label":"Supplier Number","name":"supplier_number","type":"text","placeholder":"Supplier number"},{"label":"Commodity code","name":"commodity_code","type":"text","placeholder":"Commodity code"},{"label":"PO description","name":"po_description","type":"text","placeholder":"PO description"}];
    // removed legacy __displayFields (authorization module)
    
// Notification system
function initializeNotifications() {
  var c = document.getElementById("notificationContainer");
  if (!c) {
    c = document.createElement("div");
    c.className = "notification-container";
    c.id = "notificationContainer";
    document.body.appendChild(c);
  }
}

var loadingNotification = null;

function showErrorNotification(title, message) {
  initializeNotifications();
  var container = document.getElementById("notificationContainer");
  var notification = document.createElement("div");
  notification.className = "notification error";
  notification.innerHTML = '<div class="notification-icon"><i class="fas fa-exclamation-triangle"></i></div><div class="notification-content"><div class="notification-title">' + (title || "Error") + '</div>' + (message ? '<div class="notification-message">' + message + '</div>' : '') + '</div>';
  container.appendChild(notification);
  setTimeout(function() { notification.classList.add("show", "bounce"); }, 100);
  setTimeout(function() {
    notification.classList.remove("show");
    notification.classList.add("hide");
    setTimeout(function() {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 400);
  }, 5000);
}

function showLoadingNotification(title, message) {
  initializeNotifications();
  var container = document.getElementById("notificationContainer");
  
  // Remove existing loading notification
  if (loadingNotification && loadingNotification.parentNode) {
    loadingNotification.parentNode.removeChild(loadingNotification);
  }
  
  loadingNotification = document.createElement("div");
  loadingNotification.className = "notification loading";
  loadingNotification.innerHTML = '<div class="notification-icon"><i class="fas fa-spinner fa-spin"></i></div><div class="notification-content"><div class="notification-title">' + (title || "Loading") + '</div>' + (message ? '<div class="notification-message">' + message + '</div>' : '') + '</div>';
  container.appendChild(loadingNotification);
  setTimeout(function() { loadingNotification.classList.add("show"); }, 100);
}

function hideLoadingNotification() {
  if (loadingNotification && loadingNotification.parentNode) {
    loadingNotification.classList.remove("show");
    loadingNotification.classList.add("hide");
    setTimeout(function() {
      if (loadingNotification && loadingNotification.parentNode) {
        loadingNotification.parentNode.removeChild(loadingNotification);
      }
      loadingNotification = null;
    }, 400);
  }
}

function showSuccessNotification(title, message) {
  initializeNotifications();
  var container = document.getElementById("notificationContainer");
  var notification = document.createElement("div");
  notification.className = "notification";
  notification.innerHTML = '<div class="notification-icon"><i class="fas fa-check"></i></div><div class="notification-content"><div class="notification-title">' + (title || "Success") + '</div>' + (message ? '<div class="notification-message">' + message + '</div>' : '') + '</div>';
  container.appendChild(notification);
  setTimeout(function() { notification.classList.add("show", "bounce"); }, 100);
  setTimeout(function() {
    notification.classList.remove("show");
    notification.classList.add("hide");
    setTimeout(function() {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 400);
  }, 4000);
}

// Data management functions
function _storageKey() {
  return ("taimex_records_" + (document.title || "sistema").toLowerCase().replace(/[^a-zA-Z0-9]/g, "_")).slice(0, 120);
}

function _loadRecs() {
  try {
    var t = localStorage.getItem(_storageKey());
    return t ? JSON.parse(t) : [];
  } catch (e) {
    console.error(e);
    return [];
  }
}

function _saveRecs(list) {
  try {
    localStorage.setItem(_storageKey(), JSON.stringify(list));
  } catch (e) {
    console.error(e);
  }
}

function _collect() {
  var data = {};
  var c = document.querySelector("#tab-0 .form-grid");
  (__schemaFields || []).forEach(function(f) {
    var el = c && c.querySelector("[name='" + f.name + "']");
    data[f.name] = el ? el.value : "";
  });
  return data;
}

// Tab switching functionality
function switchTab(index) {
  console.log("switchTab called with index:", index);
  try {
    var buttons = document.querySelectorAll(".tab-button");
    var panes = document.querySelectorAll(".tab-pane");
    console.log("Found buttons:", buttons.length, "panes:", panes.length);
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].classList.toggle("active", i === index);
    }
    for (var i = 0; i < panes.length; i++) {
      panes[i].classList.toggle("active", i === index);
    }
    try {
      if (index === 1) { try { setupSearchViewGrid(); } catch(_){} }
      renderGrid("");
      updateSortUI();
    } catch (e) {
      console.error("Error in switchTab rendering:", e);
    }
  } catch (e) {
    console.error("Error in switchTab:", e);
  }
  return false;
}
window.switchTab = switchTab;

// Form handlers
function handleClear() {
  document.querySelectorAll(".form-container input, .form-container textarea, .form-grid input, .form-grid textarea").forEach(function(el) {
    if (el.type !== "hidden" && el.type !== "button" && el.type !== "submit") {
      el.value = "";
    }
  });
  document.querySelectorAll(".form-container select, .form-grid select").forEach(function(el) {
    el.selectedIndex = 0;
  });
  return false;
}

function handleSave() {
  try {
    // Collect form data
    var form = document.querySelector('.form-grid');
    var formData = {
      PARTNUM: form.querySelector('[name="part_number"]').value.trim(),
      DESCRIPTION: form.querySelector('[name="part_description"]').value.trim(),
      PRODUCT_TIME: form.querySelector('[name="product_time"]').value.trim(),
      STATUS: form.querySelector('[name="status"]').value.trim(),
      LEADTIME: form.querySelector('[name="lead_time"]').value.trim(),
      SAFETYSTOCK: form.querySelector('[name="safety_stock"]').value.trim(),
      UM: form.querySelector('[name="um"]').value.trim(),
      SUPPLIER_NUMBER: form.querySelector('[name="supplier_number"]').value.trim(),
      COMMODITY_CODE: form.querySelector('[name="commodity_code"]').value.trim(),
      PO_DESCRIPTION: form.querySelector('[name="po_description"]').value.trim(),
      ACTION: 'UPSERT'
    };
    
    // Validate required fields
    if (!formData.PARTNUM) {
      showErrorNotification('Validation Error', 'Part Number is required');
      return false;
    }
    if (!formData.DESCRIPTION) {
      showErrorNotification('Validation Error', 'Part Description is required');
      return false;
    }
    
    // Show loading notification
    showLoadingNotification('Saving part...', 'Please wait while we save the part data');
    
    // Build form data for POST
    var params = new URLSearchParams();
    console.log('=== SAVE DEBUG ===');
    console.log('FormData object:', formData);
    for (var key in formData) {
      if (formData[key]) {
        params.append(key, formData[key]);
        console.log('Adding to params:', key, '=', formData[key]);
      } else {
        console.log('Skipping empty field:', key, '=', formData[key]);
      }
    }
    console.log('Final params string:', params.toString());
    
    // Send to UPDATE_PARTS.XML
    fetch('/UPDATE_PARTS.XML', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: params.toString()
    })
    .then(function(response) {
      if (!response.ok) throw new Error('HTTP ' + response.status);
      return response.text();
    })
    .then(function(xmlText) {
      try {
        console.log('=== SAVE RESPONSE DEBUG ===');
        console.log('Server response XML:', xmlText);
        
        var parser = new DOMParser();
        var doc = parser.parseFromString(xmlText, 'application/xml');
        
        var statusEl = doc.querySelector('status');
        console.log('Status element:', statusEl, 'Status value:', statusEl ? statusEl.textContent : 'null');
        
        if (statusEl && statusEl.textContent === 'success') {
          hideLoadingNotification();
          var messageEl = doc.querySelector('message');
          var successMsg = messageEl ? messageEl.textContent : 'Part saved successfully';
          showSuccessNotification('Success', successMsg);
          
          // Check if partStatus was returned in response
          var partStatusEl = doc.querySelector('partStatus');
          console.log('Part status in response:', partStatusEl ? partStatusEl.textContent : 'not found');
          
          // Refresh grid if it exists
          try { renderGrid(''); } catch (e) {}
        } else {
          hideLoadingNotification();
          var messageEl = doc.querySelector('message');
          var errorMsg = messageEl ? messageEl.textContent : 'Save failed';
          console.log('Save failed with message:', errorMsg);
          showErrorNotification('Save Error', errorMsg);
        }
      } catch (e) {
        hideLoadingNotification();
        console.error('XML parsing error:', e);
        showErrorNotification('Error', 'Failed to parse server response');
      }
    })
    .catch(function(error) {
      hideLoadingNotification();
      console.error('Save error:', error);
      showErrorNotification('Network Error', 'Failed to save part: ' + error.message);
    });
    
  } catch (e) {
    console.error('Save function error:', e);
    showErrorNotification('Error', 'An unexpected error occurred');
  }
  return false;
}

// Grid and sorting functionality
var __sortIndex = -1, __sortDir = "asc";
var __lastRenderedRows = [];

function renderGrid(filter) {
try {
  var tbody = document.getElementById("recordsTableBody");
  if (!tbody) return false;
  var recs = _loadRecs() || [];
  var q = String(filter == null ? '' : filter).toLowerCase();
  var fields = (__schemaFields || []).map(function(f){ return f && f.name; }).filter(function(n){ return !!n; });
  var escape = function(s){
    s = s == null ? '' : String(s);
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;');
  };
  var html = '';
  var displayed = 0;
  for (var i = 0; i < recs.length; i++) {
    var rec = recs[i] || {};
    if (q) {
      var matched = false;
      for (var j = 0; j < fields.length; j++) {
        var v = rec[fields[j]];
        if (v != null && String(v).toLowerCase().indexOf(q) !== -1) { matched = true; break; }
      }
      if (!matched) continue;
    }
    html += "\n          <tr class=\"excel-row\">";
    for (var j2 = 0; j2 < fields.length; j2++) {
      var key = fields[j2];
      var val = rec[key];
      html += "\n            <td class=\"excel-cell\">" + escape(val) + "</td>";
    }
    html += "\n          </tr>";
    displayed++;
  }
  if (!html) {
    var colspan = Math.max(1, fields.length);
    html = "<tr><td class='excel-cell' colspan='" + colspan + "' style='text-align:center;color:#64748b;padding:12px;'>No records</td></tr>";
  }
  tbody.innerHTML = html;
  try {
    var rc = document.querySelector('#searchViewGridWrapper .results-count');
    if (rc) rc.textContent = 'Parts Records' + (displayed >= 0 ? ' (' + displayed + ')' : '');
  } catch(_){ }
} catch (e) {
  console.error("renderGrid error:", e);
}
return false;
}

function setupSearchViewGrid() {
 try {
 // Remove any info alert referencing the old helper
 try {
   var info = document.querySelector('#tab-1 .form-container .info-alert');
   if (info && info.parentNode) info.parentNode.removeChild(info);
 } catch(_){ }

 var fc = document.querySelector('#tab-1 .form-container');
 if (!fc) return false;

 // Prefer clean id; support migrating the old helper id if present
 var wrap = document.getElementById('searchViewGridWrapper') || document.getElementById('txnAuthHelperWrapper');
 if (!wrap) {
   wrap = document.createElement('div');
   wrap.className = 'excel-grid-wrapper';
   wrap.id = 'searchViewGridWrapper';
   fc.appendChild(wrap);
 } else {
   wrap.className = 'excel-grid-wrapper';
   wrap.id = 'searchViewGridWrapper';
 }

 // Rebuild wrapper into the single Search & View grid skeleton (no FA icons)
 wrap.innerHTML = ''
   + '<div class="grid-toolbar">'
   + '  <div class="toolbar-left"><span class="results-count">Parts Records</span></div>'
   + '  <div class="toolbar-right"></div>'
   + '</div>'
   + '<div class="excel-grid-container">'
   + '  <table class="excel-grid-premium">'
   + '    <thead></thead>'
   + '    <tbody id="recordsTableBody"></tbody>'
   + '  </table>'
   + '</div>';

 // Toolbar actions
 var tr = wrap.querySelector('.grid-toolbar .toolbar-right');
 if (tr) {
   tr.innerHTML = ''
     + '<span class="toolbar-search">'
     + '  <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>'
     + '  <input type="text" class="filter-input" placeholder="Search..." oninput="return handleSearch(this.value)">' 
     + '</span>'
     + '<button type="button" class="grid-btn" onclick="return exportToCSV()">Export CSV</button>'
     + '<button type="button" class="grid-btn" onclick="return clearFilters()">Clear</button>';
 }

 // Build table header based on schema fields
 var thead = wrap.querySelector('table thead');
 var cols = (__schemaFields || []).map(function(f){ return { name: f && f.name, label: (f && (f.label || f.name)) || '' }; }).filter(function(c){ return !!c.name; });
 var h = '<tr>';
 for (var i = 0; i < cols.length; i++) {
   h += '<th class="excel-header"><div class="header-content">' + cols[i].label + '</div><span class="resize-handle"></span></th>';
 }
 h += '</tr>';
 thead.innerHTML = h;

 // Remove any stray legacy Authorization grid wrapper outside the tab container
 try {
   var stale = document.getElementById('authGridWrapper');
   if (stale && stale.parentNode) stale.parentNode.removeChild(stale);
 } catch(_){ }

 // Ensure ONLY one grid remains: remove any other children except the title and our wrapper
 try {
   var keep = new Set(['H3', 'DIV']);
   var children = Array.prototype.slice.call(fc.children);
   for (var ci = 0; ci < children.length; ci++) {
     var node = children[ci];
     if (node === wrap || node.tagName === 'H3') continue;
     fc.removeChild(node);
   }
 } catch(__){}
 
 return true;
 } catch (e) {
  console.error('setupSearchViewGrid error:', e);
  return false;
 }
}

function updateSortUI() {
// Simplified sort UI update
return true;
}

// Grid toolbar stubs and utilities
function handleSearch(q) {
try {
console.log('handleSearch:', q);
renderGrid(q || '');
} catch (e) { console.error('handleSearch error:', e); }
return false;
}
function clearFilters() {
try {
var inputs = document.querySelectorAll('.filter-input');
for (var i = 0; i < inputs.length; i++) inputs[i].value = '';
renderGrid('');
} catch (e) { console.error('clearFilters error:', e); }
return false;
}
function exportToCSV() {
try {
var recs = _loadRecs();
if (!recs || !recs.length) {
showSuccessNotification('Export', 'No data to export');
return false;
}
var cols = (__schemaFields || []).map(function(f){ return f && f.name; }).filter(function(n){ return !!n; });
var lines = [cols.join(',')];
for (var i = 0; i < recs.length; i++) {
var row = [];
for (var j = 0; j < cols.length; j++) {
var v = recs[i][cols[j]];
v = v == null ? '' : String(v);
v = v.replace(/\"/g, '""');
if (/[",\n]/.test(v)) v = '"' + v + '"';
row.push(v);
}
lines.push(row.join(','));
}
var csv = lines.join('\n');
var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
var url = URL.createObjectURL(blob);
var a = document.createElement('a');
a.href = url;
a.download = 'export.csv';
document.body.appendChild(a);
a.click();
setTimeout(function(){ URL.revokeObjectURL(url); if (a.parentNode) a.parentNode.removeChild(a); }, 0);
showSuccessNotification('Export', 'CSV downloaded');
} catch (e) { console.error('exportToCSV error:', e); }
return false;
}
function loadAllRecordsFromPicLan() {
try {
showSuccessNotification('Load', 'Demo: implement data load from PicLan');
} catch (e) { console.error('loadAllRecordsFromPicLan error:', e); }
return false;
}
function manualCleanupLocalStorage() {
  try {
    var keys = [_storageKey()];
    for (var i = 0; i < keys.length; i++) {
      try { localStorage.removeItem(keys[i]); } catch (_) {}
    }
    showSuccessNotification('Cache Cleared', 'Local storage cleared');
    try { renderGrid(''); } catch (_) {}
  } catch (e) { console.error('manualCleanupLocalStorage error:', e); }
  return false;
}

function toggleSidebar() {
try {
var chk = document.getElementById('sb-toggle');
if (chk) {
  chk.checked = !chk.checked;
} else {
  var sb = document.getElementById("sidebar");
  var ov = document.querySelector(".sidebar-overlay");
  if (!sb || !ov) return;
  sb.classList.toggle("active");
  ov.classList.toggle("active");
}
} catch (e) {
console.error("toggleSidebar error", e);
}
}

// Event listeners
document.addEventListener("click", function(ev) {
  try {
    var btn = ev.target.closest && ev.target.closest(".tab-button");
    if (btn) {
      console.log("Tab button clicked:", btn);
      var list = document.querySelectorAll(".tab-button");
      var idx = Array.prototype.indexOf.call(list, btn);
      console.log("Tab index:", idx, "switchTab function exists:", typeof window.switchTab === "function");
      if (typeof window.switchTab === "function") {
        window.switchTab(idx);
      } else {
        console.error("switchTab function not found on window object");
      }
      ev.preventDefault();
      return false;
    }
    
    // Sidebar menu links: set active state and close sidebar
    var menuLink = ev.target.closest && ev.target.closest(".sidebar-menu a, .sidebar-menu label");
    if (menuLink) {
      var links = document.querySelectorAll(".sidebar-menu a, .sidebar-menu label");
      for (var k = 0; k < links.length; k++) {
        links[k].classList.remove("active");
      }
      menuLink.classList.add("active");
      // For anchors: prevent default and close via JS
      if (menuLink.tagName && menuLink.tagName.toLowerCase() === 'a') {
        try { toggleSidebar(); } catch (e2) { /* noop */ }
        ev.preventDefault();
        return false;
      }
      // For labels: allow default behavior (toggles #sb-toggle), so do not preventDefault
      return;
    }
  } catch (e) {
    console.error("Event listener error:", e);
  }
});

// Part number lookup functions with debouncing
var lookupTimeout = null;
var currentRequest = null;

function handlePartKeyDown(event) {
  if (event.key === 'Enter') {
    event.preventDefault();
    lookupPartDescription();
  }
}

function handlePartNumberChange() {
  // Clear all auto-populated fields when part number changes
  var form = document.querySelector('.form-grid');
  var inputs = {
    part_description: form.querySelector('[name="part_description"]'),
    product_time: form.querySelector('[name="product_time"]'),
    safety_stock: form.querySelector('[name="safety_stock"]'),
    lead_time: form.querySelector('[name="lead_time"]'),
    um: form.querySelector('[name="um"]'),
    supplier_number: form.querySelector('[name="supplier_number"]'),
    commodity_code: form.querySelector('[name="commodity_code"]'),
    po_description: form.querySelector('[name="po_description"]')
  };
  
  // Clear all fields and reset placeholders
  for (var fieldName in inputs) {
    var input = inputs[fieldName];
    if (input) {
      input.value = '';
      input.style.fontStyle = 'normal';
      if (fieldName === 'part_description') {
        input.placeholder = 'Part description';
      }
    }
  }
}

function debouncedLookup() {
  // Clear existing timeout
  if (lookupTimeout) {
    clearTimeout(lookupTimeout);
  }
  
  // Cancel existing request
  if (currentRequest) {
    currentRequest.abort();
    currentRequest = null;
  }
  
  // Check if part number is empty and clear fields immediately
  var partInput = document.getElementById('partNumberInput');
  var partNumber = partInput ? partInput.value.trim() : '';
  
  if (!partNumber) {
    clearPartFields();
    return;
  }
  
  // Set new timeout for debouncing (500ms to wait for user to finish typing)
  lookupTimeout = setTimeout(function() {
    lookupPartDescription();
  }, 500);
}

function clearPartFields() {
  var form = document.querySelector('.form-grid');
  var inputs = {
    part_description: form.querySelector('[name="part_description"]'),
    product_time: form.querySelector('[name="product_time"]'),
    safety_stock: form.querySelector('[name="safety_stock"]'),
    lead_time: form.querySelector('[name="lead_time"]'),
    um: form.querySelector('[name="um"]'),
    supplier_number: form.querySelector('[name="supplier_number"]'),
    commodity_code: form.querySelector('[name="commodity_code"]'),
    po_description: form.querySelector('[name="po_description"]')
  };
  
  // Clear all auto-populated fields
  for (var fieldName in inputs) {
    var input = inputs[fieldName];
    if (input) {
      input.value = '';
      input.style.fontStyle = 'normal';
      if (fieldName === 'part_description') {
        input.placeholder = 'Part description';
      }
    }
  }
}

function lookupPartDescription() {
  var partInput = document.getElementById('partNumberInput');
  var partNumber = partInput.value.trim();
  
  console.log('=== LOOKUP DEBUG ===');
  console.log('Part number from input:', partNumber);
  
  if (!partNumber) {
    console.log('Empty part number, skipping lookup');
    return;
  }
  
  // Get all form inputs by name attribute
  var form = document.querySelector('.form-grid');
  var inputs = {
    part_description: form.querySelector('[name="part_description"]'),
    product_time: form.querySelector('[name="product_time"]'),
    status: form.querySelector('[name="status"]'),
    safety_stock: form.querySelector('[name="safety_stock"]'),
    lead_time: form.querySelector('[name="lead_time"]'),
    um: form.querySelector('[name="um"]'),
    supplier_number: form.querySelector('[name="supplier_number"]'),
    commodity_code: form.querySelector('[name="commodity_code"]'),
    po_description: form.querySelector('[name="po_description"]')
  };
  
  // Show loading state on description field
  if (inputs.part_description) {
    inputs.part_description.placeholder = 'Looking up part...';
    inputs.part_description.style.fontStyle = 'italic';
  }
  
  // Create AbortController for request cancellation
  var controller = new AbortController();
  currentRequest = controller;
  
  // Add timestamp to prevent caching
  var timestamp = new Date().getTime();
  var url = '/get_parts.xml?PART=' + encodeURIComponent(partNumber) + '&_t=' + timestamp;
  console.log('Making request to:', url);
  
  fetch(url, {
    signal: controller.signal,
    cache: 'no-cache',
    headers: {
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache'
    }
  })
    .then(function(response) {
      if (!response.ok) throw new Error('HTTP ' + response.status);
      return response.text();
    })
    .then(function(xmlText) {
      try {
        console.log('Response received for part:', partNumber);
        console.log('XML Response:', xmlText.substring(0, 200) + '...');
        
        var parser = new DOMParser();
        var doc = parser.parseFromString(xmlText, 'application/xml');
        
        // Check for errors
        var errorEl = doc.querySelector('error');
        if (errorEl) {
          console.log('Error found:', errorEl.textContent);
          if (inputs.part_description) {
            inputs.part_description.value = 'Part not found';
            inputs.part_description.style.fontStyle = 'italic';
            inputs.part_description.style.color = '#ef4444';
          }
          return;
        }
        
        // Extract and populate all fields
        var part = doc.querySelector('Part');
        if (part) {
          console.log('=== FIELD POPULATION DEBUG ===');
          // Auto-populate all available fields
          var fieldMap = {
            part_description: 'Description',
            product_time: 'ProductTime', 
            status: 'Status',
            safety_stock: 'SafetyStock',
            lead_time: 'LeadTime',
            um: 'UM',
            supplier_number: 'SupplierNumber',
            commodity_code: 'CommodityCode',
            po_description: 'PODescription'
          };
          
          for (var fieldName in fieldMap) {
            var xmlTag = fieldMap[fieldName];
            var xmlEl = part.querySelector(xmlTag);
            var input = inputs[fieldName];
            
            console.log('Field:', fieldName, 'XML Tag:', xmlTag, 'XML Element:', xmlEl, 'Content:', xmlEl ? xmlEl.textContent : 'null', 'Input:', input);
            
            if (input && xmlEl) {
              var content = xmlEl.textContent.trim();
              console.log('Processing field:', fieldName, 'with content:', content);
              if (content) {
                input.value = content;
                input.style.fontStyle = 'normal';
                input.style.color = '';
                if (fieldName === 'part_description') {
                  input.placeholder = 'Part description';
                }
                console.log('Populated field:', fieldName, 'with value:', content);
              } else {
                console.log('Empty content for field:', fieldName);
              }
            } else {
              console.log('Missing input or XML element for field:', fieldName);
            }
          }
        } else {
          if (inputs.part_description) {
            inputs.part_description.placeholder = 'No part data available';
            inputs.part_description.style.fontStyle = 'italic';
          }
        }
      } catch (e) {
        console.error('XML parsing error:', e);
        if (inputs.part_description) {
          inputs.part_description.placeholder = 'Error parsing response';
          inputs.part_description.style.fontStyle = 'italic';
        }
      }
    })
    .catch(function(error) {
      // Don't show error if request was aborted (user typed new input)
      if (error.name === 'AbortError') {
        return;
      }
      console.error('Part lookup error:', error);
      if (inputs.part_description) {
        inputs.part_description.placeholder = 'Error looking up part';
        inputs.part_description.style.fontStyle = 'italic';
      }
    })
    .finally(function() {
      // Clear current request reference
      currentRequest = null;
    });
}

// No extra JS needed for sidebar toggle; CSS-only via #sb-toggle
// Initialize Search & View grid
try { setupSearchViewGrid(); renderGrid(''); } catch (e) { console.error('init grid error:', e); }

  </script>
</body>
 </html>     